<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Derby Select2 Demo</title>

    <script src="/jquery.js"></script>
    <script src="/Sortable.js"></script>

    <script src="/derby-standalone.js"></script>

    <script>
        derby.App.prototype.getTemplate = function(filename) {
            console.warn("get template", filename)

            var el = document.getElementById(filename);
            if (el) return el;

            var result = undefined;

            $.ajax({
                method: 'GET',
                url: filename,
                async: false
            })
            .done(function(response) {
                result = response;
            })
            .fail(function() { })

            return result;
        };
    </script>

    <!-- TODO: use in-browser browserify -x Sortable -s Select2 core.js -o ../demo/select2.js -->
    <script src="/select2.js"></script>

    <!-- <link type="text/css" rel="stylesheet" href="/css/katex.css"> -->
</head>

<body>
    <h1>Derby Select2 Demo</h1>

    <h2>Simple single selection element</h2>

    <div id="single"></div>

    <script id="/single.html" type="text/template">
        <Body:>
            <view is="select2" id="select2-{{@id}}" class="form-control" options="{{_page.select2conf}}"
                data="{{_page.items}}" value="{{_page.selected}}" inherit />
            <div>selected: {{_page.selected}}</div>

        <edit-select2:>
            <div>This is the edit</div>
    </script>



    <script>
        // create the Derby app
        var app = derby.createApp();

        // Load templates from id
        app.loadViews('/single.html');
        app.component(Select2.Select2);

        // create the page
        var page = app.createPage();

        page.model.set("_page.items", [
            { id: 1, text: "first item" },
            { id: 2, text: "second item" },
            { id: 3, text: "third item" },
            { id: 4, text: "fourth item" },
        ]);

        page.model.set("_page.select2conf", {
            theme: "classic", //"bootstrap",
            multiple: false,
            normalizer: function(item) {
                console.warn("item", item)
                return {
                    item: item,
                    id: item.id,
                    title: "",
                    text: item.text
                };
            },
            resultsTemplate: "edit-select2",
            selectionTemplate: "edit-select2"
        });


        // Append the rendered template to the document. It could be inserted in any DOM location
        document.body.appendChild(page.getFragment('Body'));
    </script>

</body>

</html>
